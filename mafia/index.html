<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/ico;base64,AAABAAEAEBAAAAEACABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAABIykAIkxjACZOYAASFyAAYJCcAAABDACPsMQAAAASAAeHwgBCa24AI3iwABpITwAtXWkAHUJYAAUQHgBjnboAAxYeAAgrUwBUhKYAFyw7ADNkbAAVNTsARXiMAAoIPAAaMUEAAAAKABE9SgBSc4YAJG+WAENebAAPQU0AXW19ACR1lgAIh7oAAA0EAAAjRQAACg0AEiEkABGHsQAASXcACgUHAA9EXwAEBRkAXnGSAAENHwBOY3IAFCI5AGJ/hgBjfYkAAAk3AB5MUwBofoMASHZ+AABZjAAtNmIAZ4aJAChHVgA0YXYAa6W4AABjjwANHB8APmVnAAACCACvv8UABh09AGmKngARRE4AAAQXABouXQAAIkwANEZlACF1qQAdZG4AQ2twADdSXABXgY0AZXl+AG26ygAcRFcACgwUAAgLGgAXSV0AVY6QADQyRQBBeJcACi9hAAQhJgBAWmsAKE5aAAAFCQCMtcQAGzVGAAAGDABXdn8AACJEAHaFhwBNfJEADCYsACF2pAByh5YASoSXAEOIowB1qMIAAAoYADNAeAAADhsAAzY4ADNRbAABM0oAQEldABgdPgBjdpEAAHS6AEJziQAgSFsAPnSVAAAUNgA1ZWkADhUeABUVFQAlKzIADhokAAAlMwBNfYMAQ2FmAAAHBwBZboMAGBUeABwxTQA/ZHgAbI2gABtCSgAAaawAHUBNACQ1UAAOIz8AdJCXAHCUmgAogqUABBccAAwxRQAVLTkAPVVnAAoxVwAAGzEAn8XRABxWYgA9VXkAHTE8AABhlQAYOz8AAGuPAGqBoQAAAhQAGD1FAAslKwAFFk8AAAkOAB53qQBJg5YAOHRzAD9pdgANYZUAcYubABlHSAAmPEIACQ8OABxRVAAAHiAAWGdwADBjdwB0mbMAGhYRAB8vQAASFyYAXXF8AAADGAAMhL8AAAEkAB9BQAAAMUcAMVtgAAATGwAsYmMAHomqABaJvAAxdp4AEy8vAEuSoABke5EAMl9sACxBSQBFen0AY4GaADdnaQBMd4YAAAIEABEXHgBxgYgALEdbAFB3hgA8XnsAM2t+AA0iJAA8aHUADGqOAABRcQAFCBYANZqwAB06WQAlPEQAhairAFqDhgAIChwABBAcAFNlbAACEiIAfI+XAA8SEABhhJIAfLbMADl/lgBpfY8AcpuyABFWdwAfNTAANWdzAAoWLgAAIzEAJ09iAC9thQBUcZAAAAgOAA1IVwAnWWUAYJatACM5RQAAMUAAGhU0AEBpggAzJ0UAX3SQAEhmeQAOG08ABxAUADFcZQBTYXMAeK/KAAoSEQAiRFQAZ3qHAAg9QAAYK0AASnKLAAAAAAAAAAAA4XhT2HVSNKPebyuYgoMA7H0+Gei1BIG9H68wHUqbYY3EiyUkL0HR8WM3CUmITMtWXz+pxtlXa8Hyae1kzHy7s9cTji2/FUvDTgEp5pLCPYnl7/3I1KT7QqH5Gxqnt77fZQ9s4mrA6h4y0zOllnsWEk06ApH1Wg1yFAs4hoeQqrCgmq32GH4u/OQ5EZzzQFioIj6ZQ2cOrtVtRkRoNuN5PPh2UM/0XAUsB+5ugFuUKvB/A8V32tJxc4+T58pI6XQXT/SmrCjHHDWVR6I7l7i6VRC2nVnWySe5IbGEcAgmiiNRZvfcn+tU4M7NngpiIN20XkUxstC82/pdDGCrBoV6jAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=">
    <title>Mafia Assistant</title>
    <style type="text/css">
      #blackmail, #mayor{
        display: none;
      }
      #roleMaker{
        display: none;
        position: fixed;
        width: 100vw;
        height: 50vh;
        overflow: auto;
      }
      #roleMaker button{
        min-width: 5vw;
        height: 2vw;
      }
      #chosenRoles{
        display: flex;
        flex-flow: column wrap;
        max-height: 27vh;
        overflow: auto;
        width: 100%;
        border: solid 1px black;
        counter-reset: list;
        list-style: none;
      }
      #chosenRoles li::before{
        counter-increment: list;
        content: counter(list)". ";
      }
      h4{
        display: inline;
        font-size: 150%;
      }
      #hideWrapper{
        position: absolute;
        bottom: 64vh;
        left: 1vw;
      }
      #showWrapper{
        position: fixed;
        z-index: -1;
        top: 0px;
        left: 0px;
      }
      #hideNarrator{
        position: absolute;
        top: 0px;
        right: 0px;
        width: auto!important;
        height: auto!important;
      }
      #showNarrator{
        z-index: -1;
        position: absolute;
        bottom: 0px;
        right: 0px;
      }
      .night{
        background: black;
        color: white;
      }
      .night #anarrator{
        background: black!important;
      }
      .night .wrapper{
        background: black!important;
      }
      body{
        margin: 0px;
        min-height: 100vh;
      }
      #teams{
        overflow: auto;
        min-width: 10%;
      }
      #role{
        width: 100%;
        text-indent: 5%;
        overflow: auto;
      }
      #bugList{
        display: none;
      }
      #anarrator{
        z-index: 0;
      }
      .wrapper {
        border: 1px solid black;
        display: flex;
        height: 37vh;
        background: white;
        z-index: 0;
      }
      #graveyard {
        border: 1px solid black;
        width: calc(50% - 2px);
        margin-top: 0px;
        margin-bottom: 0px;
        overflow: auto;
      }
      #living {
        border: 1px solid black;
        width: calc(50% - 2px);
        margin-top: 0px;
        margin-bottom: 0px;
        overflow: auto;
      }
      #LoginBox {
        margin-top: 20px;
        width: 50%;
        height: 25px;
        margin-left: calc(50% - 25%);
      }
      #anarrator {
        border: 1px solid black;
        position: fixed;
        bottom: 0px;
        width: 100%;
        background: white;
        text-align: center;
      }
      #anarrator button, #anarrator audio{
        width: 50%;
        height: 4vh;
      }
      #anarrator h2, #anarrator p, #anarrator o{
        text-align: left;
      }
      p{
        width: 100%;
      }
      o{
        display: inline-block;
      }
      br{
        height: 0px;
      }
      #actionbox{
        display: flex;
        flex-flow: row wrap;
        white-space: nowrap;
        font-size: 5vw;
        overflow-y: auto;
      }
      #actionbox r{
        font-size: 2vw!important;
        display: block;
      }
      #actionbox div{
        min-width: calc(24vw - 4px);
        max-width: 25vw;
        min-height: 10vh;
        border: solid grey 2px;
        overflow-x: auto;
      }
      #actionbox .ok{
        max-width: none!important;
      }
      #actionbox button{
        height: 5vh;
        width: 15%;
        margin-left: 1%;
        position: relative;
      }
      #actionbox a{
        text-decoration: overline underline;
      }
      #black{
        width: 100%;
        height: 100%;
        position: fixed;
        background: white;
        z-index: 10;
        display: flex;
        flex-flow: column wrap;
        overflow-x: auto;
      }
      #bremove{
        position: absolute;
        top: 0px;
        right: 1vw;
        z-index: 11;
      }
    </style>
  </head>
  <body>
    <div>
      <div class="wrapper">
        <ul id="graveyard">
          <div><h3><u>Graveyard</u></h3></div>
          <div id="grave_list"></div>
        </ul>
        <ol id="living">
          <div><h3><u>Living</u></h3></div>
          <div id="living_list"></div>
        </ol>
        <div id="role"></div>
        <div id="teams"></div>
        <button type="button" id="hideWrapper" onclick="document.getElementsByClassName('wrapper')[0].style.display = 'none';document.getElementById('showWrapper').style.zIndex = '1';">X</button>
      </div>
    </div>
    <button type="button" id="showWrapper" onclick="document.getElementsByClassName('wrapper')[0].style.display = 'flex';document.getElementById('showWrapper').style.zIndex = '';">⏬</button>
    <div id="actionbox"></div>
    <input id="LoginBox" onkeydown="if(event.keyCode != 13){return;}document.getElementById(`LoginSumbit`).onclick()"/>
    <button id="LoginSumbit" onclick="submit(document.getElementById(`LoginBox`).value)">Done</button>
    <div id="roleMaker">
      <div id="roleList">

      </div>
      <div id="chosenRoles">
      </div>
    </div>
    <div>
      <div id="anarrator">
        <h2>Narrator Box</h2>
        <div id="narrate_text"></div>
        <button onclick="if(players.length >=5){startGame()}" id="start">Start</button>
        <button id="setRoles">Set Role List (wip)</button>
        <button id="next" onclick="next()">Next</button>
        <button id="mayor" onclick="mayor()">The Mayor Has Revealed.</button>
        <button id="blackmail" onclick="black()">A blackmailed player has talked / Manual kill</button>
        <!--button id="disableMusic" onclick="playMusic(true)">Start / Stop Music. If doesn't work, play the audio below.</button-->
        <audio id="disableMusic" controls autoplay src="boop.wav" onended="playMusic()"></audio>
        <button type="button" id="hideNarrator" onclick="document.getElementById('anarrator').style.display = 'none';document.getElementById('showNarrator').style.zIndex = '1';">X</button>
      </div>
      <button type="button" id="showNarrator" onclick="document.getElementById('anarrator').style.display = 'block';document.getElementById('showNarrator').style.zIndex = '';">⏫</button>
    </div>
    <div id="bugList">
      sometimes mafia has no mafia killing night 1 (MEDIUM PRIORITY)
      sometimes no mafia is added at beginning (its a feature?)
      witch can't be jailed to prevent witch effect (sorry, can't do much about this)
      when mafia gets lynched, mafia members are not immediately promoted (BIG PRIORITY)
      if vigilante gets converted, the death log says that they were killed by vampire (SMALL PRIORITY)
      mafia being bitten die even if healed (MEDIUM PRIORITY)
      TODO add win condition check (UNLIKELY)
      TODO add coven (MAYBE)
      TODO add random functions [RT,TK,TP,NK,NE,MK,etc.] (SMALL PRIORITY)
    </div>
    <script>
      //html elements
      let mus = document.getElementById("disableMusic");
      let nextButton = document.getElementById("next");
      nextButton.style.display = "none";
      let grave = document.getElementById("grave_list");
      let citizens = document.getElementById("living_list");
      let action = document.getElementById("actionbox");
      let roleinfo = document.getElementById("role");
      let team = document.getElementById("teams");
      let narrator = document.getElementById("anarrator");
      let narrator_text = document.getElementById("narrate_text");
      let may = document.getElementById("mayor");
      let blk = document.getElementById("blackmail");
      let showRoleChoose = document.getElementById("roleMaker");
      let roleChooserRoles = document.getElementById("roleList");
      let roleChoosenRoles = document.getElementById("chosenRoles");
      let toggleRoleChooser = document.getElementById("setRoles");
      //adding css when elements have stuff in it.
      let preRes = {
        action: false,
        role: false,
        team: false,
      };
      const chooseableRoles = {
        "mafioso": {
          chance: 1,
          only: 1,
          message: "Your target likes to work for the mafia. They must be a mafioso."
        },
        "godfather": {
          chance: 1,
          only: 1,
          message: "Your target is the boss of organized crime. They must be a godfather."
        },
        "janitor": {
          chance: 1,
          message: "Your target cleans bodies for the mafia. They must be a janitor."
        },
        "framer": {
          chance: 1,
          message: "Your target has a desire to decieve. They must be a framer."
        },
        "consiglier": {
          chance: 1,
          message: "Your target gathers information for the mafia. They must be a consigliere."
        },
        "bodyguard": {
          chance: 1,
          message: "Your target sells protection at unreasonable prices. They must be a bodyguard."
        },
        "doctor": {
          chance: 1,
          message: "Your target has earned the first aid merit badge. They must be a doctor."
        },
        "escort": {
          chance: 1,
          message: "Your target is a beautiful person working with the town. They must be a escort."
        },
        "sheriff": {
          chance: 1,
          message: "Your target hunts down bad guys. They must be a sheriff."
        },
        "investigator": {
          chance: 1,
          message: "Your target likes analyzing stuff. They must be a investigator."
        },
        "jailor": {
          chance: 1,
          only: 1,
          message: "Your target lives alone in front of bars. They must be a jailor."
        },
        "lookout": {
          chance: 1,
          message: "Your target likes spying on people's houses. They must be a lookout."
        },
        "mayor": {
          chance: 1,
          only: 1,
          message: "Your target is the rich politician. They must be a mayor."
        },
        "retributionist": {
          chance: 1,
          message: "Your target has the ability to bring back the dead. They must be a retributionist."
        },
        "spy": {
          chance: 1,
          message: "Your target enjoys listening to private conversations. They must be a spy."
        },
        "transporter": {
          chance: 1,
          message: "Your target owns seven taxi cabs. They must be a transporter."
        },
        "vampirehunter": {
          chance: 1,
          requires: "vampire",
          message: "Your target has garlic breath. They must be a vampire hunter."
        },
        "veteran": {
          chance: 1,
          message: "Your target is a paranoid war hero. They must be a veteran."
        },
        "vigilante": {
          chance: 1,
          message: "Your target wants justice to be served. They must be a vigilante."
        },
        "blackmailer": {
          chance: 1,
          only: 1,
          message: "Your target knows your deepest secrets. They must be a blackmailer."
        },
        "consort": {
          chance: 1,
          message: "Your target is an expert in distraction. They must be a consort."
        },
        "disguiser": {
          chance: 1,
          message: "Your target has a huge wardrobe. They must be a disguiser."
        },
        "amnesiac": {
          chance: 1,
          message: "Your target has no idea what they are. They must be a amnesiac."
        },
        "arsonist": {
          chance: 1,
          message: "Your target loves to burn things. They must be a arsonist."
        },
        "executioner": {
          chance: 1,
          message: "Your target wants to execute someone. They must be a executioner."
        },
        "jester": {
          chance: 1,
          message: "Your target is a crazy lunatic. They must be a jester."
        },
        "serialkiller": {
          chance: 1,
          message: "Your target enjoys playing with bloody knives. They must be a serialkiller."
        },
        "survivor": {
          chance: 1,
          message: "Your target wants to live. They must be a survivor."
        },
        "vampire": {
          chance: 1,
          only: 4,
          message: "Your target thirsts for blood. They must be a vampire."
        },
        "werewolf": {
          chance: 1,
          message: "Your target has nightmares during the full moon. They must be a werewolf."
        }, //currently work in progress
        "witch": {
          chance: 1,
          message: "Your target tampers with magic. They must be a witch."
        },
        "lover": {
          chance: 1,
          only: 2,
          min: 2,
          message: "Your target is in love with someone. They must be a star-crossed lover."
        }
      };
      let checkSize = setInterval(function(){
        /*global CustomEvent*/
        var resEvt = new CustomEvent("resize");
        if(roleinfo.innerText.length > 0 == preRes.role){
          preRes.role = Boolean(Math.abs(Number(preRes.role) - 1));
          resEvt.resizeTarget = roleinfo;
          resEvt.resizeSize = preRes.role;
          document.dispatchEvent(resEvt);
        }
        if(team.innerText.length > 0 == preRes.team){
          preRes.team = Boolean(Math.abs(Number(preRes.team) - 1));
          resEvt.resizeTarget = team;
          resEvt.resizeSize = preRes.team;
          document.dispatchEvent(resEvt);
        }
        if(action.innerText.length > 0 == preRes.action){
          preRes.action = Boolean(Math.abs(Number(preRes.action) - 1));
          resEvt.resizeTarget = action;
          resEvt.resizeSize = preRes.action;
          document.dispatchEvent(resEvt);
        }
      });
      let night = 1;
      let turn = 4;
      let youngestVamp = -1;
      let vampsCanAttack = true;
      function shuffle(array) {
        var currentIndex = array.length, temporaryValue, randomIndex;

        // While there remain elements to shuffle...
        while (0 !== currentIndex) {

          // Pick a remaining element...
          randomIndex = Math.floor(Math.random() * currentIndex);
          currentIndex -= 1;

          // And swap it with the current element.
          temporaryValue = array[currentIndex];
          array[currentIndex] = array[randomIndex];
          array[randomIndex] = temporaryValue;
        }

        return array;
      }
      //night is doing actions. night2 is showing results. day is day...
      let time = "day";
      let dayInfo = [];
      let fixedDayInfo = [];
      let players = [];
      let transportInfo = [];
      let dousedPlayers = [];
      let hasIgnited = false;
      let mayorRevealed = false;
      const investValues = {
        "mafioso": "Vigilante, Veteran, Mafioso",
        "godfather": "Bodyguard, Godfather, Arsonist",
        "janitor": "Retributionist, Janitor",
        "framer": "Framer, Vampire, Jester",
        "consiglier": "Investigator, Consigliere, Mayor",
        "bodyguard": "Bodyguard, Godfather, Arsonist",
        "doctor": "Doctor, Disguiser, Serial Killer",
        "escort": "Transporter, Escort, Consort",
        "sheriff": "Sheriff, Executioner, Werewolf",
        "investigator": "Investigator, Consigliere, Mayor",
        "jailor": "Spy, Blackmailer, Jailor",
        "lookout": "Lookout, Witch",
        "mayor": "Investigator, Consigliere, Mayor",
        "retributionist": "Retributionist, Janitor",
        "spy": "Spy, Blackmailer, Jailor",
        "transporter": "Transporter, Escort, Consort",
        "vampirehunter": "Survivor, Vampire Hunter, Amnesiac",
        "veteran": "Vigilante, Veteran, Mafioso",
        "vigilante": "Vigilante, Veteran, Mafioso",
        "blackmailer": "Spy, Blackmailer, Jailor",
        "consort": "Transporter, Escort, Consort",
        "disguiser": "Doctor, Disguiser, Serial Killer",
        "amnesiac": "Survivor, Vampire Hunter, Amnesiac",
        "arsonist": "Bodyguard, Godfather, Arsonist",
        "executioner": "Sheriff, Executioner, Werewolf",
        "jester": "Framer, Vampire, Jester",
        "serialkiller": "Doctor, Disguiser, Serial Killer",
        "survivor": "Survivor, Vampire Hunter, Amnesiac",
        "vampire": "Framer, Vampire, Jester",
        "witch": "Lookout, Witch",
        "werewolf": "Sheriff, Executioner, Werewolf",
      };
      const defenseValues = {
        basic: ["serialkiller","werewolf","arsonist","executioner","godfather"],
        evt: {
          "vest": 1,
          "jail": 2,
          "heal": 2,
          "alert": 1,
          "guard": 2
        }
      };
      document.addEventListener("resize",resize);
      let choseRoles = [];
      toggleRoleChooser.onclick = ()=>{
        if(showRoleChoose.style.display == "flex"){
          showRoleChoose.style.display = "none";
          return;
        }
        showRoleChooser();
      }
      //allows the narrator to choose the roles
      function showRoleChooser(){
        showRoleChoose.style.display = "flex";
        roleChooserRoles.innerHTML = "";
        for(let i in Object.keys(chooseableRoles)){
          let b = document.createElement("button"); b.innerHTML = Object.keys(chooseableRoles)[i];
          b.onclick = ()=>{addRole(Object.keys(chooseableRoles)[i])};
          roleChooserRoles.append(b);
          roleChooserRoles.append(document.createElement("br"));
        }
      }
      //adds the role to the list
      function addRole(role){
        if(chooseableRoles[role].only <= choseRoles.filter(o=>{return o == role;}).length && choseRoles.includes(role)){
          return;
        }
        choseRoles.push(role);
        if(chooseableRoles[role].min){
          for(let i = 0;i<chooseableRoles[role].min - 1;i++){
            choseRoles.push(role);
          }
        }
        updateRoleList();
      }
      //updates the role chosen list
      function updateRoleList(){
        roleChoosenRoles.innerHTML = "";
        for(let i in choseRoles){
          let l = document.createElement("li");
          l.innerHTML = choseRoles[i];
          roleChoosenRoles.append(l);
        }
      }
      const resizeStuff = {
        actionbox: "flex"
      }
      //css stuff
      function resize(resEvt){
        //console.log(resEvt);
        if(!resEvt.resizeSize){
          resEvt.resizeTarget.style.display = resizeStuff[resEvt.resizeTarget.id] ? resizeStuff[resEvt.resizeTarget.id] : "block";
        }else{
          resEvt.resizeTarget.style.display = "none";
        }
      }
      //replaces the text inside the mayor button telling who is the mayor
      function mayor(){
        if(players.filter(o=>{return !o.dead&&o.role == "mayor";}).length){
          mayorRevealed = true;
          may.innerHTML = `The mayor is ${players.filter(o=>{return !o.dead&&o.role == "mayor";})[0].name}. Click again to determine if there is a mayor later.`;
        }else{
          mayorRevealed = false;
          may.innerHTML = "The Mayor Has Revealed.";
        }
      }
      function showTeam(role){
        if(role == "vampire"){
          let vamps = players.filter(function(o) {
            return o.role == "vampire" && !o.dead;
          });
          let vampStr = "";
          for(let i in vamps){
            vampStr += `<li>${vamps[i].name}</li>`;
          }
          team.innerHTML = `<u>Vampires</u><ul>${vampStr}</ul>`;
          return;
        }
        if(role == "mafioso" || role == "janitor" || role == "godfather" || role == "blackmailer" || role == "consort" || role == "consiglier" || role == "framer" || role == "disguiser"){
          let maf = players.filter(function(o) {
            return ((!o.dead) && (o.role == "mafioso" || o.role == "janitor" || o.role == "godfather" || o.role == "blackmailer" || o.role == "consort" || o.role == "consiglier" || o.role == "framer" || o.role == "disguiser"));
          });
          let mafStr = "";
          for(let i in maf){
            mafStr += `<li>${maf[i].name} (${maf[i].role})</li>`;
          }
          team.innerHTML = `<u>Mafia</u><ul>${mafStr}</ul>`;
          return;
        }
        team.innerHTML = "";
      }
      //puts the text of who died and got revived and got remembered etc
      function generateNarratorText(){
        let str = "";
        narrator_text.innerHTML = "";
        action.innerHTML = "";
        for(let i in players){
          //if dead, and has attacks
          if(players[i].dead && dayInfo[i].information.filter(o=>{return o.type == "attack"||o.type == "infect"}).length){
            let attacks = dayInfo[i].information.filter(o=>{return o.type == "attack"||o.type == "infect"});
            let s = [];
            for(let j in attacks){
              if(attacks[j].by === null || attacks[j].by === undefined){
                s.push("other");
                continue;
              }
              s.push(players[attacks[j].by].role);
            }
            str += `<r>${players[i].name} died from ${s.join(", ")}. Their role was ${players[i].mrole ? players[i].mrole : players[i].role}</r>`;
            //if alive and has revive
            if(!players[i].dead && dayInfo[i].information.filter(o=>{return o.type=="revive";}).length){
              str+= `<r>${players[i].name} has been brought back to life!</r>`;
            }
            //if has remember
            if(dayInfo[i].information.filter(o=>{return o.type=="remember";}).length){
              let r = dayInfo[i].information.filter(o=>{return o.type=="remember";});
              for(let j in r){
                str+=`<r>${players[r[j].by].name} has remembered that they were like the ${players[i].mrole ? players[i].mrole : players[i].role}</r>`;
              }
            }
          }
          //if remembered
          if(dayInfo[i].information.filter(o=>{return o.type == "remember";}).length){
            str += `<r>An amnesiac has remembered that they were like the ${players[i].role}</r>`;
          }
          //if revived
          if(dayInfo[i].information.filter(o=>{return o.type == "revive";}).length){
            str += `<r>${players[i].name} has been brought back from the dead!</r>`;
          }
        }
        action.innerHTML = "<div class='ok'>" + str + "</div>";
      }
      //creates the buttons to control the night actions
      function createActionText(role){
        if(players[turn].dead && !(players[turn].role == "jester" && players[turn].hasWon && players[turn].actionsLeft > 0)){
          return next();
        }
        //looks at the roles and then makes buttons and stuff.
        let options;
        let string = "";
        narrator_text.innerHTML = "";
        switch (role) {
          case "lover":
          if(players[turn].specialCase){
            options = players.filter(o=>{return !o.dead && o.index != turn && o.role != "lover";});
          }else{
            options = players.filter(o=>{return !o.dead && o.index != turn;});
          }
          for(let i in options){
            if(players[turn].specialCase){
              string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to attack ${options[i].name}</p>';})()"></button></div>`;
            }else{
              string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You think ${options[i].name} is your true love</p>';})()"></button></div>`;
            }
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "witch":
          options = players.filter(o=>{
            return !o.dead;
          });
          for(let i in options){
            if(options[i].index == turn){
              string += `<div><o>${options[i].name}</o><button style="background: purple; margin-left: 5px" onclick="(function(){players[turn].NightAction.target2 = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to make your target target yourself tonight</p>';})()"></button></div>`;
              continue;
            }
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to control ${options[i].name} tonight</p>';})()"></button><button style="background: purple; margin-left: 5px" onclick="(function(){players[turn].NightAction.target2 = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to make your target target ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "mafioso":
          options = players.filter(function(o) {
            return !o.dead && !(o.role == "mafioso" || o.role == "janitor" || o.role == "godfather" || o.role == "blackmailer" || o.role == "consort" || o.role == "consiglier" || o.role == "framer" || o.role == "disguiser");
          });
          for(let i in options){
            string += `<div><o>${options[i].name} ${options[i].mrole}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You have voted to attack ${options[i].name} ${options[i].mrole}</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "godfather":
          options = players.filter(function(o) {
            return !o.dead && !(o.role == "mafioso" || o.role == "janitor" || o.role == "godfather" || o.role == "blackmailer" || o.role == "consort" || o.role == "consiglier" || o.role == "framer" || o.role == "disguiser");
          });
          let mafioso = players.filter(function(o) {
            return !o.dead && o.role == "mafioso";
          });
          for(let i in options){
            string += `<div><o>${options[i].name} ${options[i].mrole}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You have decided to attack ${options[i].name} ${options[i].mrole}</p>';})()"></button></div>`;
          }
          if(mafioso.length == 1){
            string += `<div><o>${mafioso[0].name} (${mafioso[0].role})</o><button style="background: red" onclick="(function(){players[turn].NightAction.target2 = ${mafioso[0].index}; narrator_text.innerHTML='<p>You have decided to force ${mafioso[0].name} to kill your target</p>'})()"></button>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You decided not to attack, or force a mafioso to attack.</p>'})()">cancel</a></div>`;
          break;
          case "janitor":
          if(players[turn].actionsLeft == -1){
            players[turn].actionsLeft = 3;
          }
          options = players.filter(o=>{return !o.dead && o.index != turn;});
          for(let i in options){
            string += `<div><o>${options[i].name} ${options[i].mrole}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to clean ${options[i].name} ${options[i].mrole}</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          if(players[turn].actionsLeft == 0){
            string = "<div class='ok'><p>You cannot clean any more bodies.</p></div>";
          }
          break;
          case "framer":
          options = players.filter(function(o) {
            return !o.dead && !(o.role == "mafioso" || o.role == "janitor" || o.role == "godfather" || o.role == "blackmailer" || o.role == "consort" || o.role == "consiglier" || o.role == "framer" || o.role == "disguiser");
          });
          for(let i in options){
            string += `<div><o>${options[i].name} ${options[i].mrole}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to frame ${options[i].name} ${options[i].mrole} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "consiglier":
          options = players.filter(function(o) {
            return !o.dead && !(o.role == "mafioso" || o.role == "janitor" || o.role == "godfather" || o.role == "blackmailer" || o.role == "consort" || o.role == "consiglier" || o.role == "framer" || o.role == "disguiser");
          });
          for(let i in options){
            string += `<div><o>${options[i].name} ${options[i].mrole}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to investigate ${options[i].name} ${options[i].mrole} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "bodyguard":
          if(players[turn].actionsLeft == -1){
            players[turn].actionsLeft = 1;
          }
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to guard ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          if(players[turn].actionsLeft == 1){
            string += `<div><o>${players[turn].name}</o><button style="background: lime" onclick="(function(){players[turn].NightAction.target = ${players[turn].index}; narrator_text.innerHTML='<p>You decide to put on your bulletproof vest</p>'})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "doctor":
          if(players[turn].actionsLeft == -1){
            players[turn].actionsLeft = 1;
          }
          options = players.filter(function(o) {
            return !o.dead && o.index != turn && o.role != "mayor (rev)";
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to heal ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          if(players[turn].actionsLeft == 1){
            string += `<div><o>${players[turn].name}</o><button style="background: lime" onclick="(function(){players[turn].NightAction.target = ${players[turn].index}; narrator_text.innerHTML='<p>You decide to heal yourself</p>'})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "escort":
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to escort ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "sheriff":
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to investigate ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "investigator":
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to investigate ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "jailor":
          if(players[turn].actionsLeft == -1){
            players[turn].actionsLeft = 1;
          }
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to jail ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          if(players[turn].actionsLeft == 1){
            string += `<div><o>${players[turn].name}</o><button style="background: lime" onclick="(function(){players[turn].NightAction.target2 = ${players[turn].index}; narrator_text.innerHTML = '<p>You decide to execute your target</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "lookout":
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to watch ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "mayor":
          string += `<div class='ok'><o>You are an important role. Remember to reveal when the time is right.</o></div>`;
          break;
          case "retributionist":
          if(players[turn].actionsLeft == -1){
            players[turn].actionsLeft = 1;
          }
          options = players.filter(function(o) {
            return o.dead && !(o.mrole == "cleaned") && !(o.role == "mafioso" || o.role == "janitor" || o.role == "godfather" || o.role == "blackmailer" || o.role == "consort" || o.role == "consiglier" || o.role == "framer" || o.role == "disguiser" || o.role == "survivor" || o.role == "jester" || o.role == "executioner" || o.role == "serialkiller" || o.role == "vampire" || o.role == "werewolf" || o.role == "arsonist");
          });
          if(players[turn].actionsLeft == 1){
            for(let i in options){
              string += `<div><o>${options[i].name} (${options[i].role})</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to revive ${options[i].name} (${options[i].role}) tonight</p>';})()"></button></div>`;
            }
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "spy":
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to bug the house of ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "transporter":
          options = players.filter(function(o) {
            return !o.dead;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to transport ${options[i].name} tonight</p>';})()"></button><button style="background: lime; margin-left: 5px" onclick="(function(){players[turn].NightAction.target2 = ${options[i].index}; narrator_text.innerHTML = '<p>You also decide to transport ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "vampirehunter":
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide check ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "veteran":
          if(players[turn].actionsLeft == -1){
            players[turn].actionsLeft = 3;
          }
          options = players.filter(function(o) {
            return o.index == turn;
          });
          string += `<div><o>${players[turn].name}</o><button onclick="(function(){players[turn].NightAction.target = ${players[turn].index}; narrator_text.innerHTML = '<p>You decide to alert tonight</p>';})()"></button></div>`;
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          if(players[turn].actionsLeft == 0){
            string = "<div class='ok'><o>You do not have any more alerts left</o>";
          }
          break;
          case "vigilante":
          if(players[turn].actionsLeft == -1){
            players[turn].actionsLeft = 3;
          }
          options = players.filter(function(o) {
            return !o.dead && !(o.index == turn);
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to shoot ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          if(players[turn].actionsLeft == 0){
            string = "<div class='ok'><o>You do not have any more bullets left</o>";
          }
          break;
          case "blackmailer":
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name} ${options[i].mrole}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to blackmail ${options[i].name} ${options[i].mrole} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "consort":
          options = players.filter(function(o) {
            return !o.dead && !(o.role == "mafioso" || o.role == "janitor" || o.role == "godfather" || o.role == "blackmailer" || o.role == "consort" || o.role == "consiglier" || o.role == "framer" || o.role == "disguiser");
          });
          for(let i in options){
            string += `<div><o>${options[i].name} ${options[i].mrole}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to distract ${options[i].name} ${options[i].mrole} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "disguiser":
          options = players.filter(function(o) {
            return !o.dead && !(o.role == "mafioso" || o.role == "janitor" || o.role == "godfather" || o.role == "blackmailer" || o.role == "consort" || o.role == "consiglier" || o.role == "framer" || o.role == "disguiser");
          });
          for(let i in options){
            string += `<div><o>${options[i].name} ${options[i].mrole}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to disguise as ${options[i].name} ${options[i].mrole} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You changed your mind</p>'})()">cancel</a></div>`;
          break;
          case "amnesiac":
          options = players.filter(function(o) {
            return o.dead && !(o.mrole == "cleaned") &&!(o.role == "godfather" || o.role == "mafioso" || o.role == "retributionist" || o.role == "mayor" || o.role == "jailor" || o.role == "executioner");
          });
          for(let i in options){
            string += `<div><o>${options[i].name} (${options[i].role})</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>Oh yeah! I was like the ${options[i].role}!</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>Actually... nevermind</p>'})()">cancel</a></div>`;
          break;
          case "arsonist":
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to douse ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><o>${players[turn].name}</o><button style="background: orange" onclick="(function(){players[turn].NightAction.target = ${players[turn].index}; narrator_text.innerHTML = '<p>You decide to ignite your targets tonight</p>';})()"></button></div>`;
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You change your mind, and decide to clean gas off yourself</p>'})()">cancel</a></div>`;
          break;
          case "executioner":
          if(players[turn].actionTarget == null){
            options = players.filter(function(o) {
              return !o.dead && o.index != turn;
            });
            players[turn].actionTarget = options[Math.floor(Math.random() * options.length)].index;
          }
          string = `<div class='ok'><o>Execute your target: ${players[players[turn].actionTarget].name}<o></div>`;
          break;
          case "jester":
          if(players[turn].actionsLeft == -1){
            players[turn].actionsLeft = 1;
          }
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to haunt ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You change your mind</p>'})()">cancel</a></div>`;
          if(players[turn].actionsLeft == 0){
            string = "<div class='ok'>You are out of actions.</div>";
          }
          if(!players[turn].hasWon){
            string = "<div class='ok'><o>You failed.</o>";
          }
          if(!players[turn].dead){
            string = "<div class='ok'><o>Get yourself lynched</o>";
          }
          break;
          case "serialkiller":
          options = players.filter(function(o) {
            return !o.dead && o.index != turn;
          });
          for(let i in options){
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to kill ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You change your mind</p>'})()">cancel</a></div>`;
          break;
          case "survivor":
          if(players[turn].actionsLeft == -1){
            players[turn].actionsLeft = 3;
          }
          string += `<div><o>${players[turn].name}</o><button onclick="(function(){players[turn].NightAction.target = ${players[turn].index}; narrator_text.innerHTML = '<p>You decide to put on a belletproof vest tonight</p>';})()"></button></div>`;
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You change your mind</p>'})()">cancel</a></div>`;
          if(players[turn].actionsLeft == 0){
            string = "<div class='ok'><o>You do not have any bulletproof vests left</o>"
          }
          break;
          case "vampire":
          if(youngestVamp == -1){
            youngestVamp = turn;
          }
          options = players.filter(function(o) {
            return !o.dead && o.role != "vampire";
          });
          for(let i in options){
            string += `<div><o>${options[i].name} - ${options[i].vvotes}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You vote to bite ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You change your mind</p>'})()">cancel</a></div>`;
          if(!vampsCanAttack){
            string = `<div class='ok'><o>You have to wait before voting to bite another person</o></div>`;
          }
          break;
          case "werewolf":
          options = players.filter(function(o) {
            return !o.dead;
          });
          for(let i in options){
            if(options[i].index == turn){
              string += `<div><o>${options[i].name}</o><button style="background: brown;" onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to rampage at your house tonight</p>';})()"></button></div>`;
              continue;
            }
            string += `<div><o>${options[i].name}</o><button onclick="(function(){players[turn].NightAction.target = ${options[i].index}; narrator_text.innerHTML = '<p>You decide to rampage at the house of ${options[i].name} tonight</p>';})()"></button></div>`;
          }
          string += `<div><a onclick="(function(){players[turn].NightAction = {}; narrator_text.innerHTML = '<p>You change your mind</p>'})()">cancel</a></div>`;
          if(night % 2){
            string = `<div class='ok'><o>There is no full moon tonight.</o></div>`;
          }
          break;
        }
        action.innerHTML = string;
      }
      //explains each role
      function generateRoleText(role){
        switch (role) {
          case "lover":
          roleinfo.innerHTML = "<h4 style='color:pink'>Star-Crossed Lover</h4>";
          roleinfo.innerHTML += "<p>Find and survive with your lover</p>";
          roleinfo.innerHTML += "<p>Search a player each night to determine if they are your lover. If you find them, or they find you, you will be able to attack other players with a powerful attack.</p>";
          break;
          case "witch":
          roleinfo.innerHTML = "<h4 style='color:purple'>Witch</h4>";
          roleinfo.innerHTML += "<p>Work with the evildoers to kill the town.</p>";
          roleinfo.innerHTML += "<p>Control a player to target another player.</p>";
          break;
          case "mafioso":
          roleinfo.innerHTML = "<h4 style='color:red'>Mafioso</h4>";
          roleinfo.innerHTML += "<p>Kill players that are against the mafia. Vote to kill all players that are against the mafia and do the work for the godfather</p>";
          break;
          case "godfather":
          roleinfo.innerHTML = "<h4 style='color:red'>Godfather</h4>";
          roleinfo.innerHTML += "<p>Kill players that are against the mafia. You can force a mafioso to attack as well.</p>";
          roleinfo.innerHTML += "<p>-You are immune from direct attacks on you.</p>";
          break;
          case "janitor":
          roleinfo.innerHTML = "<h4 style='color:red'>Janitor</h4>";
          roleinfo.innerHTML += "<p>Kill players that are against the mafia. You can decide to clean a player, or clean whatever player the mafia attacks.</p>";
          roleinfo.innerHTML += "<p>-Cleaned players will not have their role revealed.</p>";
          break;
          case "framer":
          roleinfo.innerHTML = "<h4 style='color:red'>Framer</h4>";
          roleinfo.innerHTML += "<p>Kill players that are against the mafia. You can frame a player, making them seem guilty.</p>";
          roleinfo.innerHTML += "<p>-Framed players will be seen as `Framer, Vampire, or Jester` to the Investigator</p>";
          break;
          case "consiglier":
          roleinfo.innerHTML = "<h4 style='color:red'>Consiglier</h4>";
          roleinfo.innerHTML += "<p>Kill players that are against the mafia. You can investigate a player and find their role.</p>";
          break;
          case "bodyguard":
          roleinfo.innerHTML = "<h4 style='color:lime'>Bodyguard</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. Protect a player from an attack. You can also protect yourself with your bulletproof vest.</p>";
          roleinfo.innerHTML += "<p>-If your target gets attacked, you and the attcker will die</p><p>-If more than one attacker attacks your target, a random attacker will die, but your target will live.</p><p>-You can only use the bulletproof vest once</p>";
          break;
          case "doctor":
          roleinfo.innerHTML = "<h4 style='color:lime'>Doctor</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. Heal a player.</p>";
          roleinfo.innerHTML += "<p>-You cannot heal the mayor once revealed</p><p>-You can only heal yourself once</p><p>-Healing will not work against arson.</p>";
          break;
          case "escort":
          roleinfo.innerHTML = "<h4 style='color:lime'>Escort</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. Role block a player</p>";
          roleinfo.innerHTML += "<p>-Roleblocking a player will prevent their action.</p>";
          break;
          case "sheriff":
          roleinfo.innerHTML = "<h4 style='color:lime'>Sheriff</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. Investigate a player to see if they are evil.</p>";
          roleinfo.innerHTML += "<p>-The Godfather will appear good.</p><p>-All mafia and neutral will appear evil.</p>";
          break;
          case "investigator":
          roleinfo.innerHTML = "<h4 style='color:lime'>Investigator</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. Investigate a player to find their roles.</p>";
          roleinfo.innerHTML += "<p>-You will see three possible roles of the player.</p>";
          break;
          case "jailor":
          roleinfo.innerHTML = "<h4 style='color:lime'>Jailor</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. You can jail a player each night.</p>";
          roleinfo.innerHTML += "<p>-Jailing a player will roleblock them and prevent attacks against them.</p><p>-You can only execute once.</p>";
          break;
          case "lookout":
          roleinfo.innerHTML = "<h4 style='color:lime'>Lookout</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. Watch a player's house to see who visits them.</p>";
          break;
          case "mayor":
          roleinfo.innerHTML = "<h4 style='color:lime'>Mayor</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. During the day, you can reveal that you are mayor by saying 'I reveal myself as Mayor'</p><p>-Once you do this, your votes count as 3. Also, you cannot be healed.</p>";
          break;
          case "retributionist":
          roleinfo.innerHTML = "<h4 style='color:lime'>Retributionist</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. You can revive a player.</p><p>-You can only revive once</p>";
          break;
          case "spy":
          roleinfo.innerHTML = "<h4 style='color:lime'>Spy</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. You can bug a player's home.</p><p>-You will know what happened to that player</p><p>-You will know if the player is blackmailed, roleblocked, jailed, doused, attacked</p><p>-You will know if the Arsonist cleaned gas off him if he is your target</p><p>-You will know if the Serial Killer kills his roleblocker if you bug a Serial Killer</p><p>-You will get a message like 'your target was rbd so they stayed at home' if your taget is a werewolf who was roleblocked. However, you will get mauled by the werewolf as well.</p><p>-You will know who the mafia visited</p>";
          break;
          case "transporter":
          roleinfo.innerHTML = "<h4 style='color:lime'>Transporter</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. You can transport up to two players.</p><p>-This will swap targets against them.</p><p>-You can transport yourself too.</p><p>-If a target was attacked by another target, nothing happens</p>";
          break;
          case "vampirehunter":
          roleinfo.innerHTML = "<h4 style='color:lime'>Vampire Hunter</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. Check a player to see if they are a vampire.</p><p>-If a vampire attacks you, you will kill them.</p><p>-When there are no more vampires, you will turn into a Vigilante</p>";
          break;
          case "veteran":
          roleinfo.innerHTML = "<h4 style='color:lime'>Veteran</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. You can alert at night to kill any visiters.</p><p>-You can alert 3 times maximum.</p>";
          break;
          case "vigilante":
          roleinfo.innerHTML = "<h4 style='color:lime'>Vigilante</h4>";
          roleinfo.innerHTML += "<p>Kill all evildoers. You can shoot players you think are evil.</p><p>-If you shoot a town player, you will die the next day due to guilt.</p><p>-You can only shoot 3 times.</p>";
          break;
          case "blackmailer":
          roleinfo.innerHTML = "<h4 style='color:red'>Blackmailer</h4>";
          roleinfo.innerHTML += "<p>Kill players that are against the mafia. Blackmail a player.</p><p>-That player may not speak the next day, otherwise they will be killed by embarassment from their secret information being leaked.</p>";
          break;
          case "consort":
          roleinfo.innerHTML = "<h4 style='color:red'>Consort</h4>";
          roleinfo.innerHTML += "<p>Kill players that are against the mafia. Roleblock a player.</p><p>-This will block their action.</p>";
          break;
          case "disguiser":
          roleinfo.innerHTML = "<h4 style='color:red'>Disguiser</h4>";
          roleinfo.innerHTML += "<p>Kill players that are against the mafia. Disguise as a player.</p><p>-This will make the Sheriff and the Investigator think you are that role.</p><p>-If you die, your role is announced as the role you disguised as.</p>";
          break;
          case "amnesiac":
          roleinfo.innerHTML = "<h4 style='color:blue'>Amnesiac</h4>";
          roleinfo.innerHTML += "<p>Remember that you were like a player that died.</p><p>-You will become that role.</p><p>-In this version of mafia, you can become ANY role that died.</p><p>-Becoming a godfather, will turn you into a mafioso</p>";
          break;
          case "arsonist":
          roleinfo.innerHTML = "<h4 style='color:orange'>Arsonist</h4>";
          roleinfo.innerHTML += "<p>Burn the world. You can douse a player, set all doused players on fire, or clean gas off yourself.</p><p>-If another arsonist douses you, you will be notified.</p><p>-Cleaning gas off yourself will prevent other arsonists from burning you.</p><p>-Igniting will also ignite ALL arsonist targets</p><p>-You can win with other arsonists.</p><p>-You are night immune to attacks targeing you</p>";
          break;
          case "executioner":
          roleinfo.innerHTML = "<h4 style='color:grey'>Executioner</h4>";
          roleinfo.innerHTML += "<p>Kill your target by lynching them.</p>-If your target dies by not being lynched, you become a Jester<p></p><p>-You are night immune to attacks targeing you</p>";
          break;
          case "jester":
          roleinfo.innerHTML = "<h4 style='color:pink'>Jester</h4>";
          roleinfo.innerHTML += "<p>Get lynched...</p>";
          break;
          case "serialkiller":
          roleinfo.innerHTML = "<h4 style='color:blue'>Serial Killer</h4>";
          roleinfo.innerHTML += "<p>Kill everyone.</p><p>-You are night immune from attacks against you</p><p>-If you are role blocked, you will kill the roleblocker instead of your target.</p>";
          break;
          case "survivor":
          roleinfo.innerHTML = "<h4 style='color:yellow'>Surviror</h4>";
          roleinfo.innerHTML += "<p>Survive. You can put on your bulletproof vest.</p><p>-You can only use your bulletproof vest once</p>";
          break;
          case "vampire":
          roleinfo.innerHTML = "<h4 style='color:purple'>Vampire</h4>";
          roleinfo.innerHTML += "<p>Kill and convert everyone into a vampire.</p><p>-The youngest vampire will attack.</p><p>-You can only convert every other night. If you kill, you can convert again</p><p>-If you visit a Vampire Hunter, you will die</p>";
          break;
          case "werewolf":
          roleinfo.innerHTML = "<h4 style='color:brown'>Werewolf</h4>";
          roleinfo.innerHTML += "<p>Kill everyone. You can attack on even nights.</p><p>-You are night immune to attacks</p><p>-If roleblocked, you will rampage at your house, killing the roleblocker.</p><p>-Your attacks are unstoppable by night immunity</p><p>If you do nothing, you will rampage at your house.</p><p>-You are not immune to other werewolves</p>";
          break;
        }
        roleinfo.innerHTML = `<h4>Night ${night}: ${players[turn].name} - </h4>` + roleinfo.innerHTML;
      }
      //roles that have limited uses
      function hasLimitedUse(role){
        return {
          match: /(veteran)|(survivor)|(vigilante)|(janitor)|(retributionist)|(bodyguard)|(doctor)/g.test(role),
          onlyIfTargetSelf: /(veteran)|(survivor)|(bodyguard)|(doctor)/g.test(role)
        }
      }
      //generates the results of the night
      function generateResultText(){
        if(dayInfo[turn].information.length == 0 && players[turn].dead){
          return next();
        }
        let str = ""
        narrator_text.innerHTML = "";
        action.innerHTML = "";
        let activity = dayInfo[turn].information;
        str += "<r>" + dayInfo[turn].main + "<r/>";
        for(let i in activity){
          //attacked
          if(/(attack)|(bitten)/g.test(activity[i].type)){
            //but jailed
            if(activity.filter(o=>{return o.type == "jail";}).length&&activity[i].value < 3){
              str += "<r>You were attacked, but you were in jail</r>";
            }else{
              str += "<r>"+activity[i].message + "</r>";
            }
            continue;
          }
          //healed
          if(activity[i].type == "heal" && activity.filter(o=>{return o.type == "attack";}).length&&!activity.filter(o=>{return o.type == "jail";}).length){
            str += "<r>A doctor healed your wounds</r>";
            continue;
          }
          //guarded
          if(activity[i].type == "guard" && activity.filter(o=>{return o.type == "attack"&&o.visit;}).length&&!activity.filter(o=>{return o.type == "jail";}).length){
            str += "<r>You were attacked, but a bodyguard fought off your attacker</r>";
            continue;
          }
          //transported
          if(activity[i].type == "transport"&&!activity.filter(o=>{return o.type == "jail";}).length){
            str += "<r>You were transported to another location</r>";
            continue;
          }
          //rb
          if(activity[i].type == "rb"&&!activity.filter(o=>{return o.type == "jail";}).length){
            str += "<r>You were role blocked</r>";
            continue;
          }
          //doused (if arso)
          if(players[turn].role == "arsonist" && activity[i].type == "douse"){
            str += "<r>You were doused by another arsonist</r>";
            continue;
          }
          if(activity[i].message){
            str += "</r>"+activity[i].message + "</r>";
          }
        }
        action.innerHTML = "<div class='ok'>" + str.replace("<r></r>","") + "</div>";
      }
      //sorts the actions of the night
      function dayUpdate(){
        hasIgnited = false;
        dayInfo = [];
        transportInfo = [];
        for(i in players){
          dayInfo.push({
            index: players[i].index,
            information: [],
            main: ""
          });
        }
        let alive = players.filter(o=>{return !o.dead || (o.role == "jester" && o.hasWon)});
        //witch stuff
        for(let i in alive){
          if(alive[i].role == "witch"){
            //if no target
            if(!(alive[i].NightAction.target >= 0)){
              continue;
            }
            //if transporter retri amne jailor or witch, skip
            if(/(transporter)|(witch)|(retributionist)|(amnesiac)|(jailor)/.test(players[alive[i].NightAction.target].role)){
              continue;
            }
            if(!(alive[i].NightAction.target2 >= 0)){
              continue;
            }
            players[alive[i].NightAction.target].NightAction = {
              target: alive[i].NightAction.target2
            };
          }
        }
        //main setters
        for(let i in alive){
          switch (alive[i].role) {
            case "lover":
            if(alive[i].specialCase2){
              dayInfo[alive[i].index].information.push({
                type: "attack",
                by: null,
                value: 3,
                message: "You could not get over your true love's death."
              });
              break;
            }
            if(alive[i].specialCase){
              alive[i].NightAction.target >= 0 ? (()=>{
                dayInfo[alive[i].NightAction.target].information.push({
                  type: "attack",
                  by: alive[i].index,
                  visit: true,
                  value: 2,
                  message: "A star-crossed lover attacked you"
                });
              })() : null;
            }else{
              alive[i].NightAction.target >= 0 ? (()=>{
                dayInfo[alive[i].NightAction.target].information.push({
                  type: "lovecheck",
                  by: alive[i].index,
                  visit: true
                });
              })() : null;
            }
            break;
            case "witch":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "witch",
                visit: true,
                by: alive[i].index,
                message: "You were witched!"
              });
            })():null;
            break;
            case "veteran":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].index].information.push({
                type: "alert",
                by: alive[i].index,
                visit: false
              });
            })() : null;
            break;
            case "mafioso":
            if(alive.filter(o=>{return o.role == "godfather" && !(o.NightAction.target2 >= 0)}).length && o.NightAction.target >= 0){
              break;
            }
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "attack",
                value: 1,
                by: alive[i].index,
                message: "You were attacked by a member of the mafia",
                visit: true
              });
            })() : null;
            if(dayInfo[alive[i].index].information.filter(o=>{return o.type == "force";}).length){
              let target = players[dayInfo[alive[i].index].information.filter(o=>{return o.type == "force";})[0].by].NightAction.target;
              if(target >= 0){
                dayInfo[target].information.push({
                  type: "attack",
                  value: 1,
                  visit: true,
                  by: alive[i].index,
                  message: "You were attacked by a member of the mafia"
                });
              }
            }
            break;
            case "godfather":
            (alive[i].NightAction.target >= 0 && !(alive[i].NightAction.target2 >= 0)) || (alive[i].NightAction.target >= 0 && !alive.filter(o=>{return o.role == "mafioso"}).length) ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "attack",
                value: 1,
                by: alive[i].index,
                message: "You were attacked by a member of the mafia",
                visit: true
              });
            })() : (()=>{
              for(let j in alive){
                if(alive[j].role == "mafioso"){
                  dayInfo[alive[j].index].information.push({
                    type: "force",
                    by: alive[i].index,
                    message: "The godfather forced you to attack his target!",
                    visit: false
                  });
                }
              }
            })();
            break;
            case "janitor":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "clean",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "framer":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "frame",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "consiglier":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "investigate",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "bodyguard":
            alive[i].NightAction.target >= 0 ? (()=>{
              if(alive[i].NightAction.target == alive[i].index){
                dayInfo[alive[i].index].information.push({
                  type: "vest",
                  by: alive[i].index,
                  visit: false
                });
              }else{
                dayInfo[alive[i].NightAction.target].information.push({
                  type: "guard",
                  by: alive[i].index,
                  visit: true
                });
              }
            })() : null;
            alive[i].NightAction.target2 >= 0 ? (()=>{
              dayInfo[alive[i].index].information.push({
                type: "vest",
                by: alive[i].index,
                visit: false
              });
            })() : null;
            break;
            case "doctor":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "heal",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            alive[i].NightAction.target2 >= 0 ? (()=>{
              dayInfo[alive[i].index].information.push({
                type: "heal",
                by: alive[i].index,
                visit: false
              });
            })() : null;
            break;
            case "escort":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "rb",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "sheriff":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "interrogate",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "investigator":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "investigate",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "jailor":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "jail",
                message: "You were jailed by the jailor",
                by: alive[i].index,
                visit: false
              });
            })() : null;
            alive[i].NightAction.target2 >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "attack",
                value: 3,
                message: "You were executed by the jailor",
                by: alive[i].index,
                visit: false
              });
            })() : null;
            break;
            case "lookout":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "watch",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "retributionist":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "revive",
                by: alive[i].index,
                visit: false
              });
            })() : null;
            break;
            case "spy":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "bug",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "transporter":
            alive[i].NightAction.target >= 0 && alive[i].NightAction.target2 >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "transport",
                message: "You were transported to another location",
                by: alive[i].index,
                visit: true,
                with: alive[i].NightAction.target2
              });
              dayInfo[alive[i].NightAction.target2].information.push({
                type: "transport",
                message: "You were transported to another location",
                by: alive[i].index,
                visit: false,
                with: alive[i].NightAction.target
              });
            })() : null;
            break;
            case "vampirehunter":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "hunt",
                value: 3,
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "vigilante":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "attack",
                value: 1,
                message: "You were shot by a vigilante",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            alive[i].specialCase ? (()=>{
              dayInfo[alive[i].index].information.push({
                type: "attack",
                visit: false,
                by: alive[i].index,
                message: "You have died from guilt over shooting a town member",
                value: 3
              });
            })():null;
            break;
            case "blackmailer":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "blackmail",
                message: "You have been blackmailed. You cannot speak during the day",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "consort":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "rb",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "disguiser":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "disguise",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "arsonist":
            alive[i].NightAction.target >= 0 && alive[i].NightAction.target != alive[i].index ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "douse",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            alive[i].NightAction.target >= 0 && alive[i].NightAction.target == alive[i].index ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "ignite",
                by: alive[i].index,
                visit: false
              });
            })() : null;
            !alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].index].information.push({
                type: "remove",
                by: alive[i].index,
                visit: false
              });
            })() : null;
            break;
            case "jester":
            alive[i].NightAction.target >= 0 && alive[i].hasWon ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "attack",
                value: 3,
                message: "You were haunted by a jester",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "serialkiller":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "attack",
                value: 1,
                message: "You were stabbed by a serial killer",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            break;
            case "werewolf":
            alive[i].NightAction.target >= 0 && alive[i].NightAction.target != alive[i].index ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "attack",
                value: 2,
                message: "You were mauled by a werewolf",
                by: alive[i].index,
                visit: true
              });
            })() : null;
            (alive[i].NightAction.target >= 0 && alive[i].NightAction.target == alive[i].index) || (!(alive[i].NightAction.target >= 0) && !(night % 2)) ? (()=>{
              dayInfo[alive[i].NightAction.target >= 0 ? alive[i].NightAction.target : alive[i].index].information.push({
                type: "attack",
                value: 0,
                by: alive[i].index,
                visit: false
              });
            })() : null;
            break;
            case "amnesiac":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].NightAction.target].information.push({
                type: "remember",
                visit: false,
                by: alive[i].index
              });
            })():null;
            break;
            case "survivor":
            alive[i].NightAction.target >= 0 ? (()=>{
              dayInfo[alive[i].index].information.push({
                type: "vest",
                visit: false,
                by: alive[i].index
              });
            })():null
            break;
          }
        }
        //sort through all stuff and fix the day info
        fixedDayInfo = [];
        //rb stuff (witches will know they are rbd, but they can use magic to do their action anyways. at least, that's the explanation i have for my laziness)
        for(let i in dayInfo){
          //evaluate actions. if rbd, jailed, etc, remove actions. Then get main results if applicable
          if(dayInfo[i].information.filter(o=>{return o.type == "jail";}).length){ //jailed
            //go through all other players to remove any actions matching the user's id
            for(let j in dayInfo){
              if(dayInfo[j].information.filter(o=>{return o.by == dayInfo[i].index;}).length){
                dayInfo[j].information = dayInfo[j].information.filter(o=>{return !(o.by == dayInfo[i].index);});
              }
            }
            //if user is sk / ww, add attack on jailor if jailor didn't execute user
            if(/(serialkiller)|(werewolf)/g.test(players[dayInfo[i].index].role) && !dayInfo[i].information.filter(o=>{return o.type == "attack" && players[o.by].role == "jailor"}).length){
              for(let j in dayInfo){
                if(players[dayInfo[j].index].role == "jailor"){
                  if((night % 2) && players[dayInfo[i].index].role == "werewolf"){
                    break;
                  }
                  dayInfo[j].information.push({
                    type: "attack",
                    value: 1,
                    by: dayInfo[i].index,
                    visit: false,
                    message: "You were attacked by the person you jailed"
                  });
                }
              }
            }
            //if user has limited uses
            if(hasLimitedUse(players[dayInfo[i].index].role).match){
              if(hasLimitedUse(players[dayInfo[i].index].role).onlyIfTargetSelf){
                if(dayInfo[i].information.filter(o=>{return o.by == dayInfo[i].index;}).length){
                  players[dayInfo[i].index].actionsLeft++;
                }
              }else{
                players[dayInfo[i].index].actionsLeft++;
              }
            }
          }
          if(dayInfo[i].information.filter(o=>{return o.type == "rb";}).length){ //rbd
            //go through all other players to remove any actions matching the user's id
            for(let j in dayInfo){
              if(dayInfo[j].information.filter(o=>{return o.by == dayInfo[i].index && o.visit && !/(escort)|(consort)/g.test(players[o.by].role);}).length){
                dayInfo[j].information = dayInfo[j].information.filter(o=>{return !(o.by == dayInfo[i].index && o.visit);});
              }
            }
            //if user is sk / ww, add attack on roleblocker
            if(/(serialkiller)|(werewolf)/g.test(players[dayInfo[i].index].role)){
              for(let j in dayInfo){
                if(/(consort)|(escort)/g.test(players[dayInfo[j].index].role) && dayInfo[i].information.filter(o=>{return o.by == dayInfo[j].index;}).length){
                  if((night % 2) && players[dayInfo[i].index].role == "werewolf"){
                    break;
                  }
                  dayInfo[j].information.push({
                    type: "attack",
                    value: 1,
                    by: dayInfo[i].index,
                    visit: false,
                    message: "You were attacked by the person you roleblocked"
                  });
                }
              }
            }
            //if user has limited uses
            if(hasLimitedUse(players[dayInfo[i].index].role).match){
              if(hasLimitedUse(players[dayInfo[i].index].role).onlyIfTargetSelf){
                if(dayInfo[i].information.filter(o=>{return o.by == dayInfo[i].index;}).length){
                  players[dayInfo[i].index].actionsLeft++;
                }
              }else{
                players[dayInfo[i].index].actionsLeft++;
              }
            }
          }
        }
        //transporter stuff
        for(let i in dayInfo){
          if(dayInfo[i].information.filter(o=>{return o.type=="transport"&&!transportInfo.includes(o.by);}).length){
            let transports = dayInfo[i].information.filter(o=>{return o.type=="transport"&&!transportInfo.includes(o.by);});
            for(let j in transports){
              transportInfo.push(transports[j].by);
              let p1 = dayInfo[i].information.filter(o=>{return o.visit&&!/(transport)|(bug)/g.test(o.type);});
              let p2 = dayInfo[transports[j].with].information.filter(o=>{return o.visit&&!/(transport)|(bug)/g.test(o.type);});
              dayInfo[i].information = dayInfo[i].information.filter(o=>{return !o.visit||/(transport)|(bug)/g.test(o.type)});
              dayInfo[transports[j].with].information = dayInfo[transports[j].with].information.filter(o=>{return !o.visit||/(transport)|(bug)/g.test(o.type)});
              for(let l in p2){
                dayInfo[i].information.push(p2[l]);
              }
              for(let l in p1){
                dayInfo[transports[j].with].information.push(p1[l]);
              }
            }
          }
        }
        //vampire stuff
        if(vampsCanAttack && players.filter(o=>{return !o.dead && o.role == "vampire";}).length){
          if(players[youngestVamp].dead){
            youngestVamp = players.filter(o=>{return !o.dead && o.role == "vampire";})[0].index;
          }
          if(dayInfo[youngestVamp].information.filter(o=>{return o.type == "jail";}).length || dayInfo[youngestVamp].information.filter(o=>{return o.type == "rb";}).length){
            //do nothing, cuz vampire was rbd
          }else{
            vampsCanAttack = false;
            let mostVoted = {
              index: -1,
              votes: -1
            };
            for(let j in players){
              if(players[j].vvotes > mostVoted.votes){
                mostVoted = {
                  index: players[j].index,
                  votes: players[j].vvotes
                }
              }
            }
            if(mostVoted.votes){
              dayInfo[mostVoted.index].information.push({
                type: "infect",
                by: youngestVamp,
                visit: true,
                message: "You were bitten by a vampire"
              });
            }
          }
        }else{
          vampsCanAttack = true;
        }
        //special veteran stuff
        for(let i in dayInfo){
          if(players[dayInfo[i].index].role == "veteran" && dayInfo[i].information.filter(o=>{return o.type=="alert";}).length && !dayInfo[i].information.filter(o=>{return o.type=="jail"}).length){
            for(let j in dayInfo[i].information){
              if(dayInfo[i].information[j].visit){
                dayInfo[dayInfo[i].information[j].by].information.push({
                  type: "attack",
                  value: 2,
                  visit: false,
                  by: dayInfo[i].index,
                  message: "You were shot by the veteran you visited"
                });
              }
            }
          }
        }
        //special bodyguard stuff
        for(let i in dayInfo){
          if(!dayInfo[i].information.filter(o=>{return o.type=="jail";}).length&&dayInfo[i].information.filter(o=>{return o.type=="attack" && o.visit;}).length&&dayInfo[i].information.filter(o=>{return o.type == "guard";}).length){
            let bgs = dayInfo[i].information.filter(o=>{return o.type == "guard";});
            for(let j in bgs){
              dayInfo[dayInfo[i].information.filter(o=>{return o.type=="attack";})[0].by].information.push({
                type: "attack",
                value: 2,
                by: bgs[j].by,
                visit: false,
                message: "You were attacked by a bodyguard"
              });
              dayInfo[bgs[j].by].information.push({
                type: "attack",
                value: 1,
                by: null,
                visit: false,
                message: "You were attacked while defending your target"
              });
            }
          }
        }
        //special werewolf stuff
        for(let i in dayInfo){
          //if user is werewolf and not jailed or roleblocked
          if(players[dayInfo[i].index].role == "werewolf" && !dayInfo[i].information.filter(o=>{return o.type=="jail"||o.type=="rb"}).length){
            for(let j in dayInfo){
              if(dayInfo[j].information.filter(o=>{return o.by == dayInfo[i].index && o.visit}).length){
                let l = dayInfo[j].information.filter(o=>{return o.by != dayInfo[i].index && o.visit});
                for(let k in l){
                  dayInfo[l[k].by].information.push({
                    type: "attack",
                    value: 2,
                    message: "You were mauled by a werewolf",
                    visit: false,
                    by: dayInfo[i].index
                  });
                }
              }
            }
          }
        }
        //special death
        for(let i in dayInfo){
          if(players[i].specialDeath){
            dayInfo[i].information.push({
              type: "attack",
              by: null,
              visit: false,
              value: 3,
              message: "You were killed for blackmail or other reasons"
            });
          }
        }
        //arsonist clean
        for(let i in dayInfo){
          if(players[dayInfo[i].index].role == "arsonist" && dayInfo[i].information.filter(o=>{return o.type=="remove";}).length && !dayInfo[i].information.filter(o=>{return o.type=="jail"||o.type=="rb";}).length){
            dousedPlayers = dousedPlayers.filter(o=>{return o != dayInfo[i].index});
          }
        }
        //arsonist douse
        for(let i in dayInfo){
          if(dayInfo[i].information.filter(o=>{return o.type=="douse";}).length && !dayInfo[i].information.filter(o=>{return o.type=="jail"}).length){
            dousedPlayers.push(dayInfo[i].index);
          }
        }
        //arsonist ignite
        for(let i in dayInfo){
          if(dayInfo[i].information.filter(o=>{return o.type=="ignite";}).length && !dayInfo[i].information.filter(o=>{return o.type=="jail"||o.type=="rb"}).length){
            hasIgnited = true;
            let igniters = dayInfo[i].information.filter(o=>{return o.type=="ignite";});
            for(let j in igniters){
              for(let k in dousedPlayers){
                if(players[dousedPlayers[k]].dead){
                  continue;
                }
                dayInfo[dousedPlayers[k]].information.push({
                  type: "attack",
                  value: 3,
                  visit: false,
                  by: igniters[j].by,
                  message: "You were set on fire by an arsonist"
                });
              }
            }
          }
        }
        //getting main results
        for(let i in dayInfo){
          switch (players[dayInfo[i].index].role) {
            case "lover":
            if(players[dayInfo[i].index].specialCase){
              break;
            }
            for(let k in dayInfo){
              if(dayInfo[k].information.filter(o=>{return o.by == dayInfo[i].index}).length){
                if(players[dayInfo[k].index].role == "lover"){
                  dayInfo[i].main = "Your target has an attractive air about them. You have found your true love!";
                  players[dayInfo[k].index].specialCase = true;
                  players[dayInfo[i].index].specialCase = true;
                  dayInfo[k].information.push({
                    type: "system",
                    visit: false,
                    by: dayInfo[i].index,
                    message: `You have been found by ${players[dayInfo[i].index].name}!`
                  });
                }else{
                  dayInfo[i].main = "You do not find your target attractive. They are not your true love.";
                }
              }
            }
            break;
            case "consiglier":
            case "witch":
            for(let j in dayInfo){
              if(dayInfo[j].information.filter(o=>{return o.by == dayInfo[i].index}).length){
                dayInfo[i].main = chooseableRoles[players[dayInfo[j].index].role].message;//`Your target's role is ${players[dayInfo[j].index].role}`;
                break;
              }
            }
            break;
            case "sheriff":
            for(let j in dayInfo){
              if(dayInfo[j].information.filter(o=>{return o.by == dayInfo[i].index}).length){
                //if framed
                if(dayInfo[j].information.filter(o=>{return o.type=="frame"}).length){
                  dayInfo[i].main = "Your target seems suspicious!"
                }else{
                  dayInfo[i].main = /(mafioso)|(janitor)|(framer)|(blackmailer)|(serialkiller)|(consort)|(consiglier)/g.test(players[dayInfo[j].index].role) ? "Your target seems suspicious":"You could not find any evidence of wrongdoing. Your target is not suspicious.";
                  //special cases
                  if(players[dayInfo[j].index].role == "disguiser"){
                    for(let k in dayInfo){
                      if(dayInfo[k].information.filter(o=>{return o.type == "disguise"&&o.by==dayInfo[j].index;}).length){
                        let fakeRole = players[dayInfo[k].index].role;
                        dayInfo[i].main = /(mafioso)|(janitor)|(framer)|(blackmailer)|(serialkiller)|(consort)|(consiglier)/g.test(fakeRole) ? "Your target seems suspicious":"You could not find any evidence of wrongdoing. Your target is not suspicious.";
                        break;
                      }
                      dayInfo[i].main = "Your target seems suspicious";
                    }
                  }
                }
                break;
              }
            }
            break;
            case "investigator":
            for(let j in dayInfo){
              if(dayInfo[j].information.filter(o=>{return o.by == dayInfo[i].index}).length){
                dayInfo[i].main = `Your target could be ${investValues[players[dayInfo[j].index].role]}`;
                //disguiser
                if(players[dayInfo[j].index].role == "disguiser"){
                  for(let k in dayInfo){
                    if(dayInfo[k].information.filter(o=>{return o.type == "disguise"&&o.by==dayInfo[j].index;}).length){
                      let fakeRole = players[dayInfo[k].index].role;
                      dayInfo[i].main = `Your target could be ${investValues[fakeRole]}`;
                      break;
                    }
                    dayInfo[i].main = `Your target could be ${investValues["disguiser"]}`;
                  }
                }
                //if framed
                if(dayInfo[j].information.filter(o=>{return o.type=="frame"}).length){
                  dayInfo[i].main = `Your target could be ${investValues["disguiser"]}`;
                }
                //if doused
                if(dousedPlayers.includes(dayInfo[j].index)){
                  dayInfo[i].main = `Your target could be ${investValues["arsonist"]}`;
                }
              }
            }
            break;
            case "lookout":
            for(let j in dayInfo){
              if(dayInfo[j].information.filter(o=>{return o.by == dayInfo[i].index}).length){
                let visitors = [];
                let v = dayInfo[j].information.filter(o=>{return o.by != dayInfo[i].index&&o.visit;});
                for(let i in v){
                  visitors.push(players[v[i].by].name);
                }
                dayInfo[i].main = `${visitors.join(", ")} visited your target.`;
              }
            }
            break;
            case "spy":
            for(let j in dayInfo){
              if(dayInfo[j].information.filter(o=>{return o.by == dayInfo[i].index}).length){
                let str = "";
                let d = dayInfo[j].information.filter(o=>{return o.by!=dayInfo[i].index&&o.visit});
                let healed = d.filter(o=>{return o.type == "heal";});
                let spied = d.filter(o=>{return o.type=="bug";});
                let transported = d.filter(o=>{return o.type=="transport";});
                let doused=d.filter(o=>{return o.type=="douse";});
                let framed=d.filter(o=>{return o.type=="frame";});
                let blackmailed=d.filter(o=>{return o.type=="blackmail";});
                let roleblocked=d.filter(o=>{return o.type=="rb";});
                let attacked=d.filter(o=>{return o.type=="attack";});
                for(let k in healed){
                  str+="A doctor attended to your target's wounds\n";
                }
                for(let k in spied){
                  str+="Your target's house was bugged\n";
                }
                for(let k in transported){
                  str+="Your target was transported\n";
                }
                for(let k in doused){
                  str+="Your target was doused by an arsonist\n";
                }
                for(let k in framed){
                  str+="Your target was framed\n";
                }
                for(let k in blackmailed){
                  str+="Your target was blackmailed\n";
                }
                for(let k in roleblocked){
                  str+="Your target was role blocked\n";
                }
                for(let k in attacked){
                  str+=`Your target was attacked by a(n) ${players[attacked[k].by].role}\n`;
                }
              }
            }
            //mafia visits
            let v = [];
            let m = dayInfo.filter(o=>{
              return o.information.filter(k=>{
                return k.visit&&/(mafioso)|(godfather)|(framer)|(janitor)|(disguiser)|(consort)|(consiglier)/g.test(players[k.by].role);
              }).length;
            });
            for(let l in m){
              v.push(players[m[l].index].name);
            }
            str += `The mafia visited ${v.join(", ")}`;
            dayInfo[i].main = str;
            break;
          }
          //if target was jailed
          if(dayInfo[i].information.filter(o=>{return o.type == "jail";}).length){
            let ppl = dayInfo[i].information.filter(o=>{
              return o.by != dayInfo[i].index && o.visit && o.type != "jail";
            });
            for(let j in ppl){
              dayInfo[ppl[j].by].main += "Your target was jailed."
            }
          }
        }
        dousedPlayers = hasIgnited ? [] : dousedPlayers;
        //changing roles and death information
        for(let i in dayInfo){ //killed
          let av = dayInfo[i].information.filter(o=>{return o.type=="attack"||(o.type=="hunt"&&players[dayInfo[i].index].role=="vampire");});
          //jailed an executed
          if(av.filter(o=>{return o.by!=null&&players[o.by].role == "jailor";}).length){
            let jailor = av.filter(o=>{return o.by!=null&&players[o.by].role == "jailor";})[0];
            if(players[jailor.by].role == "jailor" && (/(investigator)|(lookout)|(sheriff)|(spy)|(jailor)|(vampirehunter)|(veteran)|(vigilante)|(bodyguard)|(doctor)|(escort)|(mayor)|(medium)|(retributionist)|(transporter)/g.test(players[dayInfo[i].index].role)||/(investigator)|(lookout)|(sheriff)|(spy)|(jailor)|(vampirehunter)|(veteran)|(vigilante)|(bodyguard)|(doctor)|(escort)|(mayor)|(medium)|(retributionist)|(transporter)/g.test(players[dayInfo[i].index].mrole))){
              players[dayInfo[jailor.by].index].actionsLeft = 0;
            }
            //special case if lover
            if(players[dayInfo[i].index].role == "lover"){
              for(let k in players){
                if(players[k].role == "lover" && players[k].index != dayInfo[i].index){
                  players[k].specialCase2 = true;
                }
              }
            }
            players[dayInfo[i].index].dead = true;
            dayInfo[i].information.push({
              type: "system",
              visit: false,
              by: null,
              message: "You have died."
            });
            continue;
          }
          let dv = dayInfo[i].information.filter(o=>{return defenseValues.evt[o.type];});
          let dv2 = 0;
          if(defenseValues.basic.includes(players[dayInfo[i].index].role)){
            dv2 = 1;
          }
          for(let j in dv){
            if(defenseValues.evt[dv[j].type] > dv2){
              dv2 = defenseValues.evt[dv[j].type];
            }
          }
          for(let j in av){
            if(av[j].value > dv2){
              //if jailed
              if(av[j].value != 3&&dayInfo[i].information.filter(o=>{return o.type == "jail";}).length){
                dayInfo[av[j].by].information.push({
                  type: "system",
                  visit: false,
                  by: null,
                  message: "Your target was jailed"
                });
              }else{
                //special case if vigi
                if(av[j].by != null && players[dayInfo[av[j].by].index].role == "vigilante" && (/(investigator)|(lookout)|(sheriff)|(spy)|(jailor)|(vampirehunter)|(veteran)|(vigilante)|(bodyguard)|(doctor)|(escort)|(mayor)|(medium)|(retributionist)|(transporter)/g.test(players[dayInfo[i].index].role)||/(investigator)|(lookout)|(sheriff)|(spy)|(jailor)|(vampirehunter)|(veteran)|(vigilante)|(bodyguard)|(doctor)|(escort)|(mayor)|(medium)|(retributionist)|(transporter)/g.test(players[dayInfo[i].index].mrole))){
                  players[dayInfo[av[j].by].index].specialCase = true;
                  players[dayInfo[av[j].by].index].actionsLeft = 0;
                }
                //special case if lover
                if(av[j].by != null && players[dayInfo[i].index].role == "lover"){
                  for(let k in players){
                    if(players[dayInfo[i].index].mrole != "cleaned" && players[k].role == "lover" && players[k].index != dayInfo[i].index){
                      players[k].specialCase2 = true;
                    }
                  }
                }
                if(players[dayInfo[i].index].dead){
                  continue;
                }
                players[dayInfo[i].index].dead = true;
                dayInfo[i].information.push({
                  type: "system",
                  visit: false,
                  by: null,
                  message: "You have died."
                });
              }
            }else{
              dayInfo[av[j].by].information.push({
                type: "system",
                visit: false,
                by: null,
                message: "Your target's defense is too high"
              });
            }
          }
        }
        for(let i in dayInfo){ //revived
          if(dayInfo[i].information.filter(o=>{return o.type=="revive";}).length){
            players[dayInfo[i].index].dead = false;
            dayInfo[i].information.push({
              type: "system",
              visit: false,
              by: null,
              message: "You were revived by a retributionist!"
            });
          }
        }
        for(let i in dayInfo){ //transformed
          //vampires
          if(dayInfo[i].information.filter(o=>{return o.type=="infect";}).length){
            let dv = dayInfo[i].information.filter(o=>{return defenseValues.evt[o.type];});
            let dv2 = 0;
            if(defenseValues.basic.includes(players[dayInfo[i].index].role)){
              dv2 = 1;
            }
            for(let j in dv){
              if(defenseValues.evt[dv[j].type] > dv2){
                dv2 = defenseValues.evt[dv[j].type];
              }
            }
            console.log(dv2);
            //if mafia
            if(/(mafioso)|(janitor)|(framer)|(consort)|(consiglier)|(disguiser)|(blackmailer)/g.test(players[dayInfo[i].index].role)){
              if(players[dayInfo[i].index].dead){
                continue;
              }
              players[dayInfo[i].index].dead = true;
              dayInfo[i].information.push({
                type: "system",
                message: "You have died",
                by: null,
                visit: false
              });
            }else if(dv2){ //if has defense
              dayInfo[youngestVamp].information.push({
                type: "system",
                message: "Your target's defense was too high",
                by: null,
                visit: false
              });
            }else if(players[dayInfo[i].index].role == "vampirehunter"){ //if visited a vampire hunter
              dayInfo[youngestVamp].information.push({
                type: "system",
                visit: false,
                by: false,
                message: "You were staked by a vampire hunter"
              });
              players[youngestVamp].dead = true;
            }else{
              players[dayInfo[i].index].role = "vampire";
              youngestVamp = players[dayInfo[i].index].index;
              dayInfo[i].information.push({
                type: "system",
                message: "You have become a vampire",
                by: null,
                visit: false
              });
            }
          }
          //executioner
          if(players[dayInfo[i].index].role == "executioner" && !players[dayInfo[i].index].hasWon && players[dayInfo[i].index].actionTarget >= 0 && players[players[dayInfo[i].index].actionTarget].dead){
            players[dayInfo[i].index].role = "jester";
            dayInfo[i].information.push({
              type: "system",
              visit: false,
              by: null,
              message: "You have become a jester"
            });
          }
          //amnesiac
          if(dayInfo[i].information.filter(o=>{return o.type == "remember";}).length){
            let a = dayInfo[i].information.filter(o=>{return o.type == "remember";});
            for(let j in a){
              players[a[j].by].role = players[dayInfo[i].index].role;
              dayInfo[a[j].by].information.push({
                type: "system",
                visit: false,
                by: null,
                message: `You have become a(n) ${players[dayInfo[i].index].role}`
              });
            }
          }
          //vamp hunter
          if(players[dayInfo[i].index].role == "vampirehunter" && !players.filter(o=>{return o.role=="vampire"&&!o.dead}).length){
            players[dayInfo[i].index].role = "vigilante";
            dayInfo[i].information.push({
              type: "system",
              by: null,
              visit: false,
              message: "You have been promoted to vigilante"
            });
          }
        }
        //mafia transformation
        if(!players.filter(o=>{return /(godfather)|(mafioso)/g.test(o.role) && !o.dead}).length){
          let m = players.filter(o=>{return !o.dead && /(janitor)|(consort)|(disguiser)|(consiglier)|(framer)|(blackmailer)/g.test(o.role)})[0];
          if(!m){
            return;
          }
          m.role = "mafioso";
          dayInfo[m.index].information.push({
            type: "system",
            by: null,
            visit: false,
            message: "You were promoted to mafioso!"
          });
        }
        //mafia clean / disguise stuff
        for(let i in dayInfo){
          //clean
          if(dayInfo[i].information.filter(o=>{return o.type=="clean";}).length){
            players[i].mrole = "cleaned";
          }
          //disguise
          if(dayInfo[i].information.filter(o=>{return o.type=="disguise";}).length){
            let d = dayInfo[i].information.filter(o=>{return o.type=="disguise";});
            for(let j in d){
              players[d[j].by].mrole = players[i].role;
            }
          }
        }
      }
      //updates numbers and stuff
      function updateStats(){
        let lastUser;
        let role;
        try{
          lastUser = players[turn];
          role = lastUser.role;
        }catch(err){
          return;
        }
        switch (role) {
          case "janitor":
          if(typeof(lastUser.NightAction.target) != "undefined"){
            players[turn].actionsLeft--;
          }
          break;
          case "bodyguard":
          if(typeof(lastUser.NightAction.target) != "undefined"){
            if(lastUser.NightAction.target == lastUser.index){
              players[turn].actionsLeft--;
            }
          }
          break;
          case "doctor":
          if(typeof(lastUser.NightAction.target) != "undefined"){
            if(lastUser.NightAction.target == lastUser.index){
              players[turn].actionsLeft--;
            }
          }
          break;
          case "jailor":
          if(typeof(lastUser.NightAction.target2) != "undefined"){
            players[turn].actionsLeft--;
          }
          break;
          case "retributionist":
          if(typeof(lastUser.NightAction.target) != "undefined"){
            players[turn].actionsLeft--;
          }
          break;
          case "veteran":
          if(typeof(lastUser.NightAction.target) != "undefined"){
            players[turn].actionsLeft--;
          }
          break;
          case "vigilante":
          if(typeof(lastUser.NightAction.target) != "undefined"){
            players[turn].actionsLeft--;
          }
          break;
          case "survivor":
          if(typeof(lastUser.NightAction.target) != "undefined"){
            players[turn].actionsLeft--;
          }
          break;
          case "vampire":
          if(typeof(lastUser.NightAction.target) != "undefined"){
            players[lastUser.NightAction.target].vvotes++;
          }
          break;
        }
      }
      //vote buttons
      function generateVoteButtons(){
        action.innerHTML = "";
        let requiredVotes = Math.ceil((players.filter(o=>{return !o.dead;}).length + 1) / 2);
        let alive = players.filter(o=>{return !o.dead;});
        action.innerHTML = `<r>${requiredVotes} votes are required to put someone on trial</r>`;
        function a(index){ //determine whether player has enough votes
          if(players[index].votes >= requiredVotes){
            next(index);
          }
        }
        for(let i in alive){
          let div = document.createElement("div");
          let o = document.createElement("o"); o.innerHTML = `${alive[i].name} (0)`;
          let b1 = document.createElement("button"); b1.innerHTML = "+"; b1.onclick = ()=>{o.innerHTML = `${alive[i].name} (${++players[alive[i].index].votes})`;a(alive[i].index)};
          let b2 = document.createElement("button"); b2.innerHTML = "-"; b2.onclick = ()=>{o.innerHTML = `${alive[i].name} (${--players[alive[i].index].votes})`;};
          div.append(o,b1,b2);
          action.append(div);
        }
      }
      //judgement buttons
      function generateGuiltButtons(data){
        action.innerHTML = "";
        players[data].votes = 0;
        let r = document.createElement("r"); r.innerHTML = `${players[data].name} (0)`;
        let b1 = document.createElement("button"); b1.innerHTML = "+"; b1.onclick = ()=>{r.innerHTML = `${players[data].name} (${++players[data].votes})`;};
        let b2 = document.createElement("button"); b2.innerHTML = "-"; b2.onclick = ()=>{r.innerHTML = `${players[data].name} (${--players[data].votes})`;};
        let b3 = document.createElement("button"); b3.innerHTML = "Execute/Spare"; b3.onclick = ()=>{
          if(players[data].votes > 0){
            next(data);
          }else{
            next();
          }
        };
        action.append(r,b1,b2,b3);
      }
      //the turns.
      function next(data){
        //update stats based on previous player, if time is night.
        if(time == "night"){
          updateStats();
          if(turn == -1){
            playMusic();
            updatePlayerLists();
          }
        }
        turn ++;
        if(turn == players.length){
          turn = 0;
          time = time == "night" ? (function(){
            dayUpdate();
            return "night2";
          })() : "day";
        }
        if(time == "night"){
          action.innerHTML = "";
          document.body.className = "night";
          showTeam(players[turn].role);
          generateRoleText(players[turn].role);
          createActionText(players[turn].role);
        }
        if(time == "night2"){
          showTeam(players[turn].role);
          generateRoleText(players[turn].role);
          generateResultText();
        }
        if(time == "day"){
          roleinfo.innerHTML = "";
          team.innerHTML = "";
          document.body.className = "";
          updatePlayerLists();
          if(turn == 0){
            updatePlayerLists(true);
            generateNarratorText();
            playMusic();
          }
          if(turn == 1){
            playMusic();
            generateVoteButtons();
          }
          if(turn == 2){
            if(!(data >= 0)){
              return next();
            }
            generateGuiltButtons(data);
          }
          if(turn == 3){
            action.innerHTML = "no day deaths";
            //show role of executed person
            if(data >= 0){ //determine exe/jest win and lover lose
              console.log("data found");
              if(players[data].role == "jester"){
                players[data].hasWon = true;
              }
              let exe = players.filter(o=>{return o.role == "executioner" && !o.dead && o.actionTarget == data;});
              for(let i in exe){
                players[exe[i].index].hasWon = true;
              }
              players[data].dead = true;
              players[data].mrole = players[data].mrole == "cleaned" ? "" : players[data].mrole;
              action.innerHTML = `${players[data].name} was lynched by the town. Their role was ${players[data].mrole ? players[data].mrole : players[data].role}`;
              //special case if lover
              if(players[data].role == "lover"){
                for(let k in players){
                  if(players[data].mrole != "cleaned" && players[k].role == "lover" && players[k].index != data){
                    players[k].specialCase2 = true;
                  }
                }
              }
            }
            //reset stuff
            for(let i in players){
              players[i].NightAction = {};
            }
            for(let i in players){
              players[i].vvotes = 0;
            }
            for(let i in players){
              players[i].votes = 0;
            }
            for(let i in players){
              players[i].specialDeath = false;
            }
            for(let i in players){
              if(players[i].dead && players[i].mrole == "cleaned"){
                continue;
              }
              players[i].mrole = "";
            }
            night++;
            time = "night";
            turn = -1;
            updatePlayerLists(true);
          }
          if(turn == 4){
            time = "night";
            turn = -1;
            next();
          }
        }
      }
      //adding players at the start
      function submit(n){
        document.getElementById("LoginBox").value = "";
        n = n.replace(/['"`]/g,"");
        if(n == ""){
          return;
        }
        if(players.filter(o=>{return o.name == n;}).length){
          return;
        }
        players.push({
          name: n,
          role: null,
          dead: false,
          NightAction: {},
          index: players.length,
          mrole: "",
          vvotes: 0,
          actionsLeft: -1,
          actionTarget: null,
          votes: 0
        });
        updatePlayerLists();
      }
      //sets up the roles and then runs the "next" function
      //30 total roles
      function startGame(){
        may.style.display = "inline-block";
        blk.style.display = "inline-block";
        showRoleChoose.style.display = "none";
        toggleRoleChooser.style.display = "none";
        //hiding non-useful elements
        document.getElementById("LoginSumbit").style.display = "none";
        document.getElementById("start").style.display = "none";
        document.getElementById("LoginBox").style.display = "none";
        nextButton.style.display = "";
        let roles = [];
        let maxMaf = Math.ceil((players.length / 3) - 1);
        //if roles are chosen
        if(choseRoles.length < players.length){
          //start randomizing stuff
          while(roles.length < players.length){
            let choice = Math.round(Math.random() * Object.keys(chooseableRoles).length);
            let luck = Math.random();
            let keys = Object.keys(chooseableRoles);
            choice = keys[choice];
            if(typeof(choice) == "undefined"){
              console.log("choice err");
              continue;
            }
            if(chooseableRoles[choice].chance >= luck){
              if(typeof(chooseableRoles[choice].only) == "number"){
                let sameTyp = roles.filter(function(o){
                  return o == choice;
                });
                if(sameTyp.length == chooseableRoles[choice].only){
                  continue;
                }
                if(typeof(chooseableRoles[choice].min) == "number"){
                  if(players.length < roles.length + chooseableRoles[choice].min){
                    continue;
                  }
                  for(let i = 0;i<chooseableRoles[choice].min - 1;i++){
                    roles.push(choice);
                  }
                }
                roles.push(choice);
                chooseableRoles[choice].chance = chooseableRoles[choice].chance / 2;
                continue;
              }
              if(typeof(chooseableRoles[choice].min) == "number"){
                if(players.length < roles.length + chooseableRoles[choice].min){
                  continue;
                }
                for(let i = 0;i<chooseableRoles[choice].min;i++){
                  roles.push(choice);
                }
                chooseableRoles[choice].chance = chooseableRoles[choice].chance / 2;
                continue;
              }
              if(typeof(chooseableRoles[choice].requires) == "string"){
                if(!roles.includes(chooseableRoles[choice].requires)){
                  continue;
                }
                roles.push(choice);
                chooseableRoles[choice].chance = chooseableRoles[choice].chance / 2;
                continue;
              }
              if(choice == "mafioso" || choice == "janitor" || choice == "godfather" || choice == "blackmailer" || choice == "consort" || choice == "consiglier" || choice == "framer" || choice == "disguiser"){
                let currentMafia = roles.filter(function(o) {
                  return o == "mafioso" || o == "janitor" || o == "godfather" || o == "blackmailer" || o == "consort" || o == "consiglier" || o == "framer" || o == "disguiser";
                });
                if(currentMafia.length >= maxMaf){
                  continue;
                }
                if(!((currentMafia.includes("mafioso") || currentMafia.includes("godfather"))) && currentMafia.length == maxMaf - 1){
                  console.log("adding mafioso; lack of mafia killing; at number " + roles.length);
                  roles.push("mafioso");
                  chooseableRoles["mafioso"].chance = chooseableRoles["mafioso"].chance / 2;
                  continue;
                }
                roles.push(choice);
                chooseableRoles[choice].chance = chooseableRoles[choice].chance / 2;
                continue;
              }
              let mafiaCount = roles.filter(function(o) {
                return o == "mafioso" || o == "janitor" || o == "godfather" || o == "blackmailer" || o == "consort" || o == "consiglier" || o == "framer" || o == "disguiser";
              });
              let mafKillCount = roles.filter(function(o) {
                return o == "mafioso" || o == "godfather";
              });
              if(Math.ceil(maxMaf / 2) > mafiaCount.length && roles.length >= players.length - Math.ceil(maxMaf / 2)){
                chooseableRoles[choice].chance = chooseableRoles[choice].chance / 2;
                console.log("Not enough mafia...");
                if(mafKillCount.length == 0){
                  roles.push("mafioso");
                  console.log("... including killing mafia");
                }
                continue;
              }
              roles.push(choice);
              chooseableRoles[choice].chance = chooseableRoles[choice].chance / 2;
              continue;
            }
          }
          console.log(roles);
        }else{
          roles = shuffle(choseRoles);
        }
        //assign roles to players...
        for(let i in players){
          players[i].role = roles[i];
        }
        turn = 3;
        next();
      }
      function updatePlayerLists(showRoles){
        grave.innerHTML = "";
        citizens.innerHTML = "";
        for(let i in players){
          (players[i].dead ? grave : citizens).innerHTML += `<li>${players[i].name} ${showRoles ? `(${players[i].role})` : ""}</li>`;
        }
      }
      //blackmail / manual killing
      function black(){
        let d = document.createElement("div"); d.id = "black";
        let a = players.filter(o=>{return !o.dead;});
        for(let i in a){
          let e = document.createElement("div");
          let t = document.createElement("button"); t.innerHTML = a[i].name;
          t.onclick = ()=>{
            players[a[i].index].specialDeath = !players[a[i].index].specialDeath;
          };
          e.append(t);
          d.append(e);
        }
        let b = document.createElement("button");
        b.innerHTML = "X";
        b.id = "bremove";
        b.onclick = ()=>{
          d.outerHTML = "";
        }
        d.append(b);
        document.body.append(d);
      }
      //music cuz who doesn't like music?
      function playMusic(toggle){
        /*if(toggle){
          if(typeof(oldAudio) != "undefined"){
            oldAudio.pause();
            oldAudio = undefined;
            return;
          }
        }
        if(typeof(oldAudio) != "undefined"){
          oldAudio.oncanplaythrough = null;
          oldAudio.pause();
          oldAudio = undefined;
        }*/
        let music = {
          lobby: ["HomepageMusic.mp3","LobbyMusic.mp3","LoginMusicCoven.mp3","SelectionMusic.mp3"],
          day: ["DayMusic.mp3","DiscussionMusic.mp3","VotingMusic.mp3"],
          night: ["NightMusic.mp3"],
          voting: ["VotingMusic.mp3","Judgement.mp3"]
        }
        let a;
        switch (time) {
          case "night":
          case "night2":
          if(turn == -1){
            mus.src = /*a = new Audio(*/music.night[Math.floor(Math.random() * music.night.length)];//);
          }else{
            mus.src = /*a = new Audio(*/music.night[Math.floor(Math.random() * music.night.length)];//);
          }
          break;
          case "day":
          switch (turn) {
            case 1:
            case 2:
            case 3:
            mus.src = /*a = new Audio(*/music.voting[Math.floor(Math.random() * music.voting.length)];//);
            break;
            case 4:
            mus.src = /*a = new Audio(*/music.lobby[Math.floor(Math.random() * music.lobby.length)];//);
            break;
            default:
            mus.src = /*a = new Audio(*/music.day[Math.floor(Math.random() * music.day.length)];//);
            break;
          }
          break;
        }
        /*a.oncanplaythrough = ()=>{
          a.play();
        }*/
        /*a.onended = ()=>{
          playMusic();
        }*/
        /*window.oldAudio = a;
        return a;*/
      }
    </script>
  </body>
</html>
